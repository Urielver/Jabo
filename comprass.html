<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Compra Jabones</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <!-- PDF Generator -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body class="bg-green-50 text-gray-800 p-4">
  <div class="max-w-md mx-auto bg-white p-6 rounded shadow">
    <h1 class="text-2xl font-bold mb-4">Compra tu jabón</h1>
    <form id="orderForm" class="space-y-4">
      <input type="text" id="nombre" placeholder="Tu nombre" class="w-full border p-2 rounded" required />
      <select id="producto" class="w-full border p-2 rounded" required>
        <option value="">Selecciona un jabón</option>
        <option value="Avena y Miel">Avena y Miel</option>
        <option value="Rosa Mosqueta">Rosa Mosqueta</option>
        <option value="Carbón Activado">Carbón Activado</option>
      </select>
      <input type="number" id="cantidad" placeholder="Cantidad" class="w-full border p-2 rounded" required min="1" />
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded">Comprar</button>
    </form>
    <p id="mensaje" class="mt-4 text-green-700 font-semibold"></p>
  </div>

  <!-- Factura Oculta -->
  <div id="facturaContainer" class="hidden bg-white p-4 border mt-6 max-w-md mx-auto">
    <div id="factura">
      <h2 class="text-xl font-bold mb-2">Factura de Compra</h2>
      <p><strong>Cliente:</strong> <span id="facturaNombre"></span></p>
      <p><strong>Producto:</strong> <span id="facturaProducto"></span></p>
      <p><strong>Cantidad:</strong> <span id="facturaCantidad"></span></p>
      <p><strong>Fecha:</strong> <span id="facturaFecha"></span></p>
      <p><strong>Total:</strong> $<span id="facturaTotal"></span></p>
    </div>
    <button id="btnDescargar" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">Descargar Factura PDF</button>
  </div>

  <script>
    // Configuración Firebase (reemplaza con tus datos)
    const firebaseConfig = {
            apiKey: "AIzaSyCU2khNhW9XAFZXu-SmYOgoplOGJDC1Ds8", // <--- ¡Copia tu API Key de Firebase!
            authDomain: "alquimia-natural-eca99.firebaseapp.com", // <--- ¡Copia tu Auth Domain!
            projectId: "alquimia-natural-eca99", // <--- ¡Copia tu Project ID!
            storageBucket: "alquimia-natural-eca99.firebasestorage.app", // <--- ¡Copia tu Storage Bucket!
            messagingSenderId: "939257613295", // <--- ¡Copia tu Messaging Sender ID!
            appId: "1:939257613295:web:f01f18c15b5789a6b4c41a", // <--- ¡Copia tu App ID!
            measurementId: "G-WRLCWFLGF9" // Si lo tienes, si no, puedes omitirlo
        }
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let nombreFactura = "";

    document.getElementById('orderForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const nombre = document.getElementById('nombre').value;
      const producto = document.getElementById('producto').value;
      const cantidad = parseInt(document.getElementById('cantidad').value);
      const precioUnitario = 1200;
      const total = cantidad * precioUnitario;
      const fecha = new Date().toLocaleDateString();

      // Guardar en Firestore
      db.collection("pedidos").add({
        nombre, producto, cantidad, total, fecha: new Date()
      }).then(() => {
        document.getElementById('mensaje').textContent = "¡Pedido registrado! Puedes descargar tu factura.";
        
        // Llenar factura
        document.getElementById('facturaNombre').textContent = nombre;
        document.getElementById('facturaProducto').textContent = producto;
        document.getElementById('facturaCantidad').textContent = cantidad;
        document.getElementById('facturaFecha').textContent = fecha;
        document.getElementById('facturaTotal').textContent = total;
        nombreFactura = nombre;

        // Mostrar sección de factura
        document.getElementById('facturaContainer').classList.remove('hidden');

        // Limpiar el formulario
        document.getElementById('orderForm').reset();
      });
    });

    // Botón para descargar factura
    document.getElementById('btnDescargar').addEventListener('click', function () {
      const factura = document.getElementById('factura');
      html2pdf()
        .set({
          margin: 10,
          filename: 'Factura_' + nombreFactura.replace(/\s/g, '_') + '.pdf',
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        })
        .from(factura)
        .save();
    });
  </script>
</body>
</html>
