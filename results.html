<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alquimia Natural – Resultados de Votación</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fuentes -->
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    /* ---------- Variables de diseño ---------- */
    body{font-family:'Inter',sans-serif;background:#f7fafc;scroll-behavior:smooth;}

    .font-decorative{font-family:'Dancing Script',cursive;}
    .soft-green-bg{background:#D1FAE5;}
    .soft-green-text{color:#01130d;}
    .dark-green-bg{
      background:url(imagen/Jabon-de-lavanda-768x432.jpg) center/cover no-repeat;
    }
    .dark-green-text{color:#065F46;}

    /* Altura pantalla menos header (≈80 px) */
    .min-h-screen-minus-header{min-height:calc(100vh - 80px);}

    /* Transiciones menú móvil */
    .mobile-menu{max-height:0;overflow:hidden;transition:max-height .3s ease-out;}
    .mobile-menu.active{max-height:500px;transition:max-height .3s ease-in;}

    /* Botón flotante “volver arriba” */
    .fixed-button{display:none;}
    .fixed-button.show{display:block;}

    /* ----------- Tabla estilo Excel ---------- */
    .excel-table-container{overflow-x:auto;border:1px solid #e2e8f0;border-radius:.5rem;box-shadow:0 1px 3px rgba(0,0,0,.1);}
    .excel-table{width:100%;border-collapse:collapse;min-width:600px;}
    .excel-table th,.excel-table td{border:1px solid #cbd5e0;padding:.75rem;text-align:left;}
    .excel-table th{background:#edf2f7;font-weight:600;color:#2d3748;text-transform:uppercase;font-size:.875rem;}
    .excel-table tbody tr:nth-child(even){background:#f7fafc;}
    .excel-table tbody tr:hover{background:#e2e8f0;transition:background-color .2s;}

    /* Texto de sección */
    .textoresul{padding:10px;}
  </style>
</head>
<body class="relative" id="top">
  <!-- ====== NAV ====== -->
  <nav class="dark-green-bg p-4 shadow-lg sticky top-0 z-50">
    <div class="container mx-auto flex justify-between items-center">
      <a href="#top" class="text-4xl font-bold flex items-center soft-green-text">
        <img src="imagen/logo4.png" alt="Logo Alquimia Natural"
             class="h-20 w-auto mr-7 rounded-full" />
        <span class="font-decorative underline">Alquimia Natural</span>
      </a>

      <!-- Btn hamburguesa -->
      <button id="mobileMenuButton" aria-label="Abrir menú móvil"
              class="text-black md:hidden focus:outline-none">
        <svg class="w-8 h-8" fill="none" stroke="currentColor"
             viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round"
                stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Menú escritorio -->
      <div class="hidden md:flex space-x-6 items-center">
        <a href="inicio.html"      class="text-white hover:text-green-200">Inicio</a>
        <a href="#como-hacer"      class="text-white hover:text-green-200">Cómo Hacer</a>
        <a href="results.html"     class="text-white hover:text-green-200">Resultados</a>
        <a href="tarjeta.html"     class="text-white hover:text-green-200">Tarjeta</a>
        <a href="compras.html"     class="text-white hover:text-green-200">Comprar</a>
        <a href="votaciones.html"  class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 transition">
          Votar
        </a>
        <!-- Botón logout (oculto por defecto) -->
        <button id="logoutButtonNav"
                class="hidden bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 transition">
          Cerrar Sesión
        </button>
      </div>
    </div>

    <!-- Menú móvil -->
    <div id="mobileMenu" class="mobile-menu md:hidden mt-4 space-y-2">
      <a href="inicio.html"     class="block text-gray-800 py-2 px-4 hover:bg-green-700 rounded-md">Inicio</a>
      <a href="gracias.html"    class="block text-gray-800 py-2 px-4 hover:bg-green-700 rounded-md">Gracias</a>
      <a href="tarjeta.html"    class="block text-gray-800 py-2 px-4 hover:bg-green-700 rounded-md">Tarjeta</a>
      <a href="results.html"    class="block text-gray-800 py-2 px-4 hover:bg-green-700 rounded-md">Resultado</a>
      <a href="compras.html"    class="block text-gray-800 py-2 px-4 hover:bg-green-700 rounded-md">Compra</a>
      <a href="votaciones.html" class="block bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-green-700 text-center mt-1">
        Votar
      </a>
      <!-- Botón logout móvil -->
      <button id="logoutButtonMobile"
              class="hidden w-full bg-gray-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-700 mt-1">
        Cerrar Sesión
      </button>
    </div>
  </nav>

  <!-- ====== CONTENIDO ====== -->
  <div class="textoresul">
    <!-- Hero -->
    <section id="results-hero" class="soft-green-bg py-16 md:py-24 text-center">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl md:text-4xl font-semibold mb-6 text-green-800">
          Resultados de Votación de Jabones
        </h2>
        <p class="text-lg md:text-xl text-green-700 max-w-3xl mx-auto">
          Aquí puedes ver todas las votaciones registradas.
        </p>
      </div>
    </section>

    <!-- Login -->
    <section id="login-section"
             class="py-16 md:py-20 bg-gray-50 flex items-center justify-center min-h-screen-minus-header">
      <div class="max-w-md bg-white p-8 rounded-lg shadow-lg mx-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center mb-8 text-green-800">
          Acceso a Resultados
        </h2>
        <form id="loginForm">
          <label class="block mb-4">
            <span class="text-sm font-bold text-gray-700">Usuario:</span>
            <input id="username" name="username" type="text" required
                   class="mt-1 block w-full border rounded py-2 px-3 shadow focus:outline-none focus:ring focus:border-green-300" />
          </label>
          <label class="block mb-6">
            <span class="text-sm font-bold text-gray-700">Contraseña:</span>
            <input id="password" name="password" type="password" required
                   class="mt-1 block w-full border rounded py-2 px-3 shadow focus:outline-none focus:ring focus:border-green-300" />
          </label>
          <button type="submit"
                  class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded focus:outline-none">
            Iniciar Sesión
          </button>
          <div id="loginMessage" class="mt-4 text-center text-sm font-semibold text-red-600"></div>
        </form>
      </div>
    </section>

    <!-- Resultados (ocultos hasta login) -->
    <section id="results-content" class="py-16 md:py-20 bg-gray-50 hidden">
      <div class="container mx-auto px-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center mb-8 text-green-800">Detalle de Votaciones</h2>

        <!-- Tabla votos -->
        <div class="excel-table-container">
          <table id="votesTable" class="excel-table">
            <thead>
              <tr>
                <th>Nº Persona</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Jabón Votado</th>
                <th>Fecha y Hora</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <p class="text-center mt-6 text-lg">
          Total de Votos: <span id="totalVotes" class="font-bold">0</span>
        </p>

        <!-- Sorteo -->
        <div class="text-center mt-12 p-6 bg-white rounded-lg shadow-md">
          <h3 class="text-2xl font-bold mb-4 text-green-800">¡Realizar Sorteo!</h3>
          <button id="drawButton"
                  class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full focus:outline-none text-lg">
            Realizar Sorteo
          </button>

          <!-- Resultado sorteo -->
          <div id="drawResults"
               class="mt-6 p-4 border border-green-300 bg-green-50 rounded-md text-green-900 font-semibold hidden">
            <p class="text-xl mb-2">¡El/Los Ganador/es es/son:</p>
            <ul id="winnerList" class="list-disc list-inside text-left mx-auto max-w-sm"></ul>
          </div>
          <button id="resetDrawButton"
                  class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded mt-4 hidden">
            Reiniciar Sorteo
          </button>
        </div>

        <!-- Clasificación -->
        <div class="text-center mt-12 p-6 bg-white rounded-lg shadow-md">
          <h3 class="text-2xl font-bold mb-4 text-green-800">Clasificación de Votos por Jabón</h3>
          <div id="soapClassification"
               class="grid grid-cols-1 md:grid-cols-2 gap-4 text-lg"></div>
        </div>

        <!-- Estadísticas -->
        <div class="text-center mt-12 p-6 bg-white rounded-lg shadow-md">
          <h3 class="text-2xl font-bold mb-4 text-green-800">Estadísticas Generales</h3>
          <p class="text-lg text-gray-700 mb-2">
            Total de Personas que Votaron: <span id="uniqueVoters" class="font-bold">0</span>
          </p>
          <p class="text-lg text-gray-700">
            Visitas a la Página Principal (index.html): <span id="pageVisitsCount" class="font-bold">0</span>
          </p>
        </div>

        <!-- Administración -->
        <div class="text-center mt-12 p-6 bg-red-50 rounded-lg shadow-md border-red-300">
          <h3 class="text-2xl font-bold mb-4 text-red-800">Administración</h3>
          <button id="resetVotesButton"
                  class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mr-4">
            Restablecer Votaciones
          </button>
          <button id="logoutButton"
                  class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
            Cerrar Sesión
          </button>
        </div>
      </div>
    </section>
  </div>

  <!-- Btn volver arriba -->
  <a id="backToTopBtn"
     href="#top"
     class="fixed-button fixed bottom-4 right-4 z-50 bg-green-600 text-white px-6 py-3 rounded-full shadow-lg font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition">
    Volver Arriba
  </a>

  <!-- ====== SCRIPTS ====== -->
  <script>
    /* ---- Variables de elementos ---- */
    const mobileMenuButton = document.getElementById('mobileMenuButton');
    const mobileMenu        = document.getElementById('mobileMenu');
    const backToTopBtn      = document.getElementById('backToTopBtn');
    const votesTableBody    = document.querySelector('#votesTable tbody');
    const totalVotesSpan    = document.getElementById('totalVotes');
    const drawButton        = document.getElementById('drawButton');
    const drawResultsDiv    = document.getElementById('drawResults');
    const winnerList        = document.getElementById('winnerList');
    const resetDrawButton   = document.getElementById('resetDrawButton');
    const soapClassificationDiv = document.getElementById('soapClassification');
    const uniqueVotersSpan  = document.getElementById('uniqueVoters');
    const pageVisitsCountSpan = document.getElementById('pageVisitsCount');

    const loginSection  = document.getElementById('login-section');
    const resultsContent = document.getElementById('results-content');
    const loginForm     = document.getElementById('loginForm');
    const loginMessage  = document.getElementById('loginMessage');

    const resetVotesButton   = document.getElementById('resetVotesButton');
    const logoutButton       = document.getElementById('logoutButton');
    const logoutButtonNav    = document.getElementById('logoutButtonNav');
    const logoutButtonMobile = document.getElementById('logoutButtonMobile');

    /* ---- Configuración básica ---- */
    const CORRECT_USERNAME = 'uriel';
    const CORRECT_PASSWORD = '123';
    const RESET_PASSWORD   = 'vargas';

    let allVotes = [];

    /* ---- Menú móvil ---- */
    mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('active'));
    mobileMenu.querySelectorAll('a').forEach(a => a.addEventListener('click', () => mobileMenu.classList.remove('active')));
    window.addEventListener('resize', () => { if (window.innerWidth >= 768) mobileMenu.classList.remove('active'); });

    /* ---- Btn volver arriba ---- */
    window.addEventListener('scroll', () => {
      backToTopBtn.classList.toggle('show', window.scrollY > 300);
    });

    /* ---- Login ---- */
    loginForm.addEventListener('submit', e => {
      e.preventDefault();
      const u = document.getElementById('username').value.trim();
      const p = document.getElementById('password').value.trim();
      if (u === CORRECT_USERNAME && p === CORRECT_PASSWORD) {
        localStorage.setItem('loggedIn','true');
        iniciarSesion();
      } else loginMessage.textContent = 'Usuario o contraseña incorrectos.';
    });

    function iniciarSesion(){
      loginSection.classList.add('hidden');
      resultsContent.classList.remove('hidden');
      logoutButtonNav.classList.remove('hidden');
      logoutButtonMobile.classList.remove('hidden');
      cargarTodo();
    }

    /* ---- Cargar datos y estadísticas ---- */
    function cargarTodo(){
      cargarVotos();
      actualizarClasificacion();
      actualizarEstadisticas();
    }

    function cargarVotos(){
      allVotes = JSON.parse(localStorage.getItem('soapVotes')||'[]');
      votesTableBody.innerHTML = '';
      if(!allVotes.length){
        votesTableBody.innerHTML = `<tr><td colspan="5" class="text-center text-gray-500 py-4">Aún no hay votos registrados.</td></tr>`;
        deshabilitarSorteo(true,'No hay votos para sortear');
      }else{
        allVotes.forEach((v,i)=>{
          const row = votesTableBody.insertRow();
          row.innerHTML = `
            <td>${i+1}</td><td>${v.voterName}</td><td>${v.voterLastName}</td>
            <td>${v.soap}</td><td>${new Date(v.timestamp).toLocaleString('es-AR')}</td>`;
        });
        deshabilitarSorteo(false,'Realizar Sorteo');
      }
      totalVotesSpan.textContent = allVotes.length;
    }

    function deshabilitarSorteo(state,text){
      drawButton.disabled = state;
      drawButton.textContent = text;
      drawButton.classList.toggle('bg-gray-400',state);
      drawButton.classList.toggle('cursor-not-allowed',state);
      drawButton.classList.toggle('bg-blue-600',!state);
      drawButton.classList.toggle('hover:bg-blue-700',!state);
    }

    /* ---- Sorteo ---- */
    drawButton.addEventListener('click', ()=>{
      if(!allVotes.length) return;
      const ganador = allVotes[Math.floor(Math.random()*allVotes.length)];
      winnerList.innerHTML = `<li>${ganador.voterName} ${ganador.voterLastName} (votó: ${ganador.soap})</li>`;
      drawResultsDiv.classList.remove('hidden');
      deshabilitarSorteo(true,'Sorteo Realizado');
      resetDrawButton.classList.remove('hidden');
    });
    resetDrawButton.addEventListener('click',()=>{
      drawResultsDiv.classList.add('hidden');
      winnerList.innerHTML='';
      deshabilitarSorteo(!allVotes.length,'Realizar Sorteo');
      resetDrawButton.classList.add('hidden');
    });

    /* ---- Clasificación votos ---- */
    function actualizarClasificacion(){
      const counts = {};
      allVotes.forEach(v=>counts[v.soap] = (counts[v.soap]||0)+1);
      soapClassificationDiv.innerHTML = Object.keys(counts).length
        ? Object.entries(counts).sort((a,b)=>b[1]-a[1]).map(([k,c])=>`
            <div class="bg-gray-100 p-3 rounded-md flex justify-between">
              <span>${k}</span><span class="font-bold text-green-700">${c} votos</span>
            </div>`).join('')
        : '<p class="text-gray-500">No hay votos para clasificar aún.</p>';
    }

    /* ---- Estadísticas ---- */
    function actualizarEstadisticas(){
      const unicos = new Set(allVotes.map(v=>`${v.voterName} ${v.voterLastName}`));
      uniqueVotersSpan.textContent = unicos.size;
      pageVisitsCountSpan.textContent = parseInt(localStorage.getItem('indexPageVisits')||0);
    }

    /* ---- Restablecer votos ---- */
    resetVotesButton.addEventListener('click',()=>{
      const pass = prompt('Ingrese la contraseña para restablecer:');
      if(pass===RESET_PASSWORD && confirm('¿Restablecer TODO?')){
        localStorage.removeItem('soapVotes');
        localStorage.removeItem('indexPageVisits');
        alert('Restablecido.');
        location.reload();
      } else if(pass!==null) alert('Contraseña incorrecta.');
    });

    /* ---- Logout ---- */
    [logoutButton,logoutButtonNav,logoutButtonMobile].forEach(btn=>btn.addEventListener('click',()=>{
      localStorage.removeItem('loggedIn');location.reload();
    }));

    /* ---- Mantener sesión si recargo ---- */
    document.addEventListener('DOMContentLoaded',()=>{
      if(localStorage.getItem('loggedIn')==='true') iniciarSesion();
    });

    /* ---- Escuchar storage (multi-pestaña) ---- */
    window.addEventListener('storage',e=>{
      if(['soapVotes','indexPageVisits','loggedIn'].includes(e.key)){
        if(localStorage.getItem('loggedIn')==='true') {cargarTodo(); resetDrawButton.click();}
        else location.reload();
      }
    });
  </script>

  <!-- FOOTER -->
  <footer class="bg-green-800 text-white py-8 text-center mt-16">
    <p>&copy; 2025 Jabones Artesanales. Todos los derechos reservados.</p>
    <p class="mt-2">Hecho por alumnos 3°1 – cens452.</p>
  </footer>
</body>
</html>